<style type="text/css">
    #pair-template {height:100%;display:flex;flex-direction:column;align-items:center}
    #pair-form {position:relative;width:90%}
    .row {margin-bottom:1em}
    .logo {display:block;position:relative;width:25vw;height:25vw;margin:10vw auto;background-position:center center;background-repeat:no-repeat;background-size:contain;background-image:url(./../assets/icon.svg)}
    .invalid > label {color: #FF0000 !important}
    .invalid > input {border-bottom:1px solid #FF0000 !important}
    .button {width:100% !important}
    .button:disabled,.button[disabled] {background-color:#ffffff !important;color: #ffffff !important;}
</style>

<div id="pair-template">
    <div id="pair-form">
        <div class="logo"></div>

        <div class="row">
            <label for="pair-url">URL</label>
            <input id="pair-url" placeholder="https://www.website.com" type="text" value="" />
        </div>

        <div class="row">
            <label for="pair-port" data-i18n="port">Port</label>
            <input id="pair-port" type="text" value="2222" />
        </div>

        <div class="row">
            <label for="pair-user" data-i18n="username">Username</label>
            <input id="pair-user" type="text" value="" />
        </div>

        <div class="row">
            <label for="pair-pass" data-i18n="password">Password</label>
            <input id="pair-pass" type="password" value="" />
        </div>

        <div class="row">
            <button class="button" id="pair-button" onclick="search();" data-i18n="login">Login</button>
        </div>
    </div>
</div>

<script type="text/javascript">
    function search () {
        var error = false;

        let invalids = document.getElementsByClassName('invalid');
        for (var i = 0; i < invalids.length; i++) {
           invalids[i].classList.remove('invalid');
        }

        var pBtn  = document.getElementById('pair-button');
        var pUrl  = document.getElementById('pair-url');
        var pPort = document.getElementById('pair-port');
        var pUser = document.getElementById('pair-user');
        var pPass = document.getElementById('pair-pass');

        pBtn.disabled = true;

        if (pUrl.value.trim().length === 0) {
            pUrl.parentNode.classList.add('invalid');
            error = true;
        }

        if (pPort.value.trim().length === 0 || isNaN(pPort.value)) {
            pPort.parentNode.classList.add('invalid');
            error = true;
        }

        if (pUser.value.trim().length === 0) {
            pUser.parentNode.classList.add('invalid');
            error = true;
        }

        if (pPass.value.length === 0) {
            pPass.parentNode.classList.add('invalid');
            error = true;
        }

        if (error) {
            pBtn.disabled = false;
            return false;
        }

        let data = {
            url: pUrl.value,
            port: pPort.value,
            username: pUser.value,
            password: pPass.value
        };

        Homey.emit('search_devices', data, (error, result) => {
            pBtn.disabled = false;

            if (error) {
                Homey.alert(error.message);
            } else {
                Homey.showView('list_devices');
            }
        });
    }
</script>